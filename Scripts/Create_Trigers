-- Trigger for setting the primary key in the MERCHANT table
CREATE OR REPLACE TRIGGER TRG_BEFORE_INSERT_MERCHANT
BEFORE INSERT ON MERCHANT
FOR EACH ROW
BEGIN
    IF :NEW.MERCHANT_ID IS NULL THEN
        SELECT SEQ_MERCHANT_ID.NEXTVAL INTO :NEW.MERCHANT_ID FROM DUAL;
    END IF;
END;


-- Trigger for setting the primary key in the ESTABLISHMENT table
CREATE OR REPLACE TRIGGER TRG_BEFORE_INSERT_ESTABLISHMENT
BEFORE INSERT ON ESTABLISHMENT
FOR EACH ROW
BEGIN
    IF :NEW.ESTABLISHMENT_ID IS NULL THEN
        SELECT SEQ_ESTABLISHMENT_ID.NEXTVAL INTO :NEW.ESTABLISHMENT_ID FROM DUAL;
    END IF;
END;


-- Trigger for audit fields in the MERCHANT table
CREATE OR REPLACE TRIGGER TRG_AUDIT_MERCHANT
BEFORE INSERT OR UPDATE ON MERCHANT
FOR EACH ROW
BEGIN
    -- Set UPDATED_AT to the current timestamp
    :NEW.UPDATED_AT := CURRENT_TIMESTAMP;

    -- Set UPDATED_BY to the current session user
    :NEW.UPDATED_BY := USER;
END;


-- Trigger for audit fields in the ESTABLISHMENT table
CREATE OR REPLACE TRIGGER TRG_AUDIT_ESTABLISHMENT
BEFORE INSERT OR UPDATE ON ESTABLISHMENT
FOR EACH ROW
BEGIN
    -- Set UPDATED_AT to the current timestamp
    :NEW.UPDATED_AT := CURRENT_TIMESTAMP;

    -- Set UPDATED_BY to the current session user
    :NEW.UPDATED_BY := USER;
END;
